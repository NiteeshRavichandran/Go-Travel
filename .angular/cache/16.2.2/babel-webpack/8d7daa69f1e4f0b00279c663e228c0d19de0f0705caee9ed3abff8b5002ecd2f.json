{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/seat.service\";\nimport * as i2 from \"src/app/auth/auth.service\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@angular/common\";\nfunction BusSeatComponent_ng_container_19_tr_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\")(12, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function BusSeatComponent_ng_container_19_tr_1_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const seat_r1 = i0.ɵɵnextContext().$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.cancelSeat(seat_r1.name, seat_r1.seatPrice));\n    });\n    i0.ɵɵtext(13, \"Cancel Seat\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const seat_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(seat_r1.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((seat_r1.passengerDetails == null ? null : seat_r1.passengerDetails.passengerName) || \"N/A\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((seat_r1.passengerDetails == null ? null : seat_r1.passengerDetails.passengerAge) || \"N/A\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((seat_r1.passengerDetails == null ? null : seat_r1.passengerDetails.passengerGender) || \"N/A\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(seat_r1.seatPrice || \"N/A\");\n  }\n}\nfunction BusSeatComponent_ng_container_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, BusSeatComponent_ng_container_19_tr_1_Template, 14, 5, \"tr\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const seat_r1 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", seat_r1.seatStatus === \"booked\");\n  }\n}\nexport let BusSeatComponent = /*#__PURE__*/(() => {\n  var _class;\n  class BusSeatComponent {\n    constructor(seatService, authService, http, cd) {\n      this.seatService = seatService;\n      this.authService = authService;\n      this.http = http;\n      this.cd = cd;\n      this.lowerSingleSeats = [];\n      this.singleUpperBerthSeats = [];\n      this.doubleLowerBerthSeats = [];\n      this.doubleUpperBerthSeats = [];\n      this.allSeats = [];\n      this.allSeats2 = [];\n      // console.log('bs');\n      setTimeout(() => {\n        this.allSeats = this.allSeats.concat(this.singleUpperBerthSeats, this.doubleLowerBerthSeats, this.doubleUpperBerthSeats, this.lowerSingleSeats);\n        this.allSeats2 = this.allSeats2.concat(this.doubleLowerBerthSeats, this.doubleUpperBerthSeats);\n      }, 400);\n    }\n    ngOnInit() {\n      const seatData = this.seatService.getSeatData();\n      // console.log(seatData);\n      for (const seatName in seatData) {\n        if (seatData.hasOwnProperty(seatName)) {\n          const seat = seatData[seatName];\n          if (seatName.startsWith('LS')) {\n            this.lowerSingleSeats.push({\n              name: seatName,\n              ...seat\n            });\n          } else if (seatName.startsWith('SUB')) {\n            this.singleUpperBerthSeats.push({\n              name: seatName,\n              ...seat\n            });\n          } else if (seatName.startsWith('DLB')) {\n            this.doubleLowerBerthSeats.push({\n              name: seatName,\n              ...seat\n            });\n          } else if (seatName.startsWith('DUB')) {\n            this.doubleUpperBerthSeats.push({\n              name: seatName,\n              ...seat\n            });\n          }\n        }\n      }\n      // Sort the arrays by seat name numerically\n      this.lowerSingleSeats.sort((a, b) => {\n        const aNumber = parseInt(a.name.match(/\\d+/)[0], 10);\n        const bNumber = parseInt(b.name.match(/\\d+/)[0], 10);\n        return aNumber - bNumber;\n      });\n      this.singleUpperBerthSeats.sort((a, b) => {\n        const aNumber = parseInt(a.name.match(/\\d+/)[0], 10);\n        const bNumber = parseInt(b.name.match(/\\d+/)[0], 10);\n        return aNumber - bNumber;\n      });\n      this.doubleLowerBerthSeats.sort((a, b) => {\n        const aNumber = parseInt(a.name.match(/\\d+/)[0], 10);\n        const bNumber = parseInt(b.name.match(/\\d+/)[0], 10);\n        return aNumber - bNumber;\n      });\n      this.doubleUpperBerthSeats.sort((a, b) => {\n        const aNumber = parseInt(a.name.match(/\\d+/)[0], 10);\n        const bNumber = parseInt(b.name.match(/\\d+/)[0], 10);\n        return aNumber - bNumber;\n      });\n      setTimeout(() => {}, 300);\n      // console.log(this.lowerSingleSeats);\n      // console.log(this.singleUpperBerthSeats);\n      // console.log(this.doubleLowerBerthSeats);\n      // console.log(this.doubleUpperBerthSeats);\n    }\n\n    logout() {\n      this.authService.logout();\n    }\n    getSeatClass(seatStatus) {\n      return {\n        booked: seatStatus === 'booked',\n        Available: seatStatus === 'Available',\n        selected: seatStatus === 'selected',\n        ladies: seatStatus === 'ladies',\n        ladiesSelected: seatStatus === 'ladiesSelected',\n        gents: seatStatus === 'gents',\n        gentsSelected: seatStatus === 'gentsSelected'\n      };\n    }\n    adjacent(seatname, seatprice) {\n      const seatData = {\n        name: seatname,\n        passengerDetails: {\n          passengerName: '',\n          passengerAge: '',\n          passengerGender: ''\n        },\n        seatPrice: seatprice,\n        seatStatus: 'Available'\n      };\n      this.allSeats2.forEach((seat, index, array) => {\n        if (seat.name === seatname) {\n          const adjacentSeatIndex = index % 12 + 1 <= 6 ? index + 6 : index - 6;\n          if ((array[adjacentSeatIndex].seatStatus === 'ladies' || array[adjacentSeatIndex].seatStatus === 'gents') && array[adjacentSeatIndex].seatStatus !== 'Available') {\n            const data = {\n              seatStatus: 'Available',\n              seatPrice: array[adjacentSeatIndex].seatPrice,\n              passengerDetails: {\n                passengerName: '',\n                passengerAge: '',\n                passengerGender: ''\n              }\n            };\n            const busId = this.seatService.getBusData();\n            this.http.put('https://go-travel-42246-default-rtdb.firebaseio.com/busses/-' + busId + '/seats/' + array[adjacentSeatIndex].name + '.json', data).subscribe(() => {\n              if (seatname.startsWith('DUB')) {\n                this.doubleUpperBerthSeats.forEach((seat, index, array) => {\n                  if (seat.name === seatname) {\n                    array[index] = seatData;\n                  }\n                });\n              }\n              if (seatname.startsWith('DLB')) {\n                this.doubleLowerBerthSeats.forEach((seat, index, array) => {\n                  if (seat.name === seatname) {\n                    array[index] = seatData;\n                  }\n                });\n              }\n              this.cd.detectChanges();\n              this.reload();\n            });\n          }\n        }\n      });\n    }\n    reload() {\n      this.allSeats = [];\n      this.allSeats = this.allSeats.concat(this.singleUpperBerthSeats, this.doubleLowerBerthSeats, this.doubleUpperBerthSeats, this.lowerSingleSeats);\n    }\n    cancelSeat(seatName, seatprice) {\n      const data = {\n        seatStatus: 'Available',\n        seatPrice: seatprice,\n        passengerDetails: {\n          passengerName: '',\n          passengerAge: '',\n          passengerGender: ''\n        }\n      };\n      const seatData = {\n        name: seatName,\n        passengerDetails: {\n          passengerName: '',\n          passengerAge: '',\n          passengerGender: ''\n        },\n        seatPrice: seatprice,\n        seatStatus: 'Available'\n      };\n      const busId = this.seatService.getBusData();\n      this.http.put('https://go-travel-42246-default-rtdb.firebaseio.com/busses/-' + busId + '/seats/' + seatName + '.json', data).subscribe(res => {\n        // console.log(dta.seatName + res+ 'success'+ busId);\n        this.adjacent(seatName, seatprice);\n        if (seatName.startsWith('DUB')) {\n          this.doubleUpperBerthSeats.forEach((seat, index, array) => {\n            if (seat.name === seatName) {\n              array[index] = seatData;\n            }\n          });\n        }\n        if (seatName.startsWith('DLB')) {\n          this.doubleLowerBerthSeats.forEach((seat, index, array) => {\n            if (seat.name === seatName) {\n              array[index] = seatData;\n            }\n          });\n        }\n        if (seatName.startsWith('LS')) {\n          this.lowerSingleSeats.forEach((seat, index, array) => {\n            if (seat.name === seatName) {\n              array[index] = seatData;\n            }\n          });\n        }\n        if (seatName.startsWith('SUB')) {\n          this.singleUpperBerthSeats.forEach((seat, index, array) => {\n            if (seat.name === seatName) {\n              array[index] = seatData;\n            }\n          });\n        }\n        this.cd.detectChanges();\n        this.reload();\n        window.alert('Ticket canceled successfully!');\n      }, error => {\n        // console.log(error);\n        window.alert('Error: ' + error.message);\n      });\n    }\n  }\n  _class = BusSeatComponent;\n  _class.ɵfac = function BusSeatComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.SeatService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"app-bus-seat\"]],\n    decls: 20,\n    vars: 1,\n    consts: [[1, \"container\"], [1, \"table\", \"table-bordered\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function BusSeatComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"br\");\n        i0.ɵɵelementStart(1, \"div\")(2, \"div\", 0)(3, \"table\", 1)(4, \"thead\")(5, \"tr\")(6, \"th\");\n        i0.ɵɵtext(7, \"Seat Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"th\");\n        i0.ɵɵtext(9, \"Passenger Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"th\");\n        i0.ɵɵtext(11, \"Passenger Age\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13, \"Passenger Gender\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\");\n        i0.ɵɵtext(15, \"Seat Price\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"th\");\n        i0.ɵɵtext(17, \"Action\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(18, \"tbody\");\n        i0.ɵɵtemplate(19, BusSeatComponent_ng_container_19_Template, 2, 1, \"ng-container\", 2);\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(19);\n        i0.ɵɵproperty(\"ngForOf\", ctx.allSeats);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf],\n    styles: [\".seats[_ngcontent-%COMP%]{width:275px;height:650px;display:flex;justify-content:center;column-gap:35px;background-color:#dacdcd;margin-right:20px}.ctnr[_ngcontent-%COMP%]{display:flex;margin-top:30px}.seat-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex-direction:column;justify-content:center;align-items:center}.seat[_ngcontent-%COMP%]{width:45px;height:40px;margin:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;cursor:pointer}.berth[_ngcontent-%COMP%]{width:50px;height:90px;margin:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;cursor:pointer}.booked[_ngcontent-%COMP%]{background-color:#e97f68;cursor:not-allowed}.admin[_ngcontent-%COMP%]{cursor:not-allowed}.Available[_ngcontent-%COMP%]{background-color:#fff}.ladies[_ngcontent-%COMP%]{background-color:#facfd5}.gents[_ngcontent-%COMP%]{background-color:#bba9a9}.selected[_ngcontent-%COMP%]{background-color:#66cdaa}.legend[_ngcontent-%COMP%]{border:1px solid #ccc;padding:10px;margin:20px;max-width:300px;height:auto}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:5px}.legend-color[_ngcontent-%COMP%]{border:1px solid black;width:20px;height:20px;margin-right:10px}.seat-item[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}label[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.table[_ngcontent-%COMP%]{border-color:#d3c6c6}\"]\n  });\n  return BusSeatComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}